```
bLIP: 4
Title: Experimental Accountable Signaling
Status: Active
Author: Carla Kirk-Cohen <carla@chaincode.com>
        elnosh <elnosh@pm.me>
Created: 2024-01-12
License: CC0
```

## Abstract

HTLC accountability signaling is a [proposed](https://github.com/lightning/bolts/pull/1280)
component of a [hybrid approach](https://research.chaincode.com/2022/11/15/unjamming-lightning) 
to addressing [channel jamming attacks](https://bitcoinops.org/en/topics/channel-jamming-attacks) 
against the Lightning Network. This bLIP outlines a proposal to deploy an 
experimental accountable TLV to the network to provide real world data to
inform specification of reputation algorithms.

## Copyright

This bLIP is licensed under the CC0 license.

## Specification

### Adding an HTLC: `update_add_htlc`:

1. `tlv_stream`: `update_add_htlc_tlvs`
    1. type: 106823 (`accountable`)
    2. data:
        * [`byte`:`accountable`]

The 3 least significant bits of the accountable TLV are used to represent an
accountability value. A HTLC is considered to be accountable if it is received
with `accountable=7` and unaccountable if `accountable=0`.

Sender:
* if it is the original source of the HTLC:
  * SHOULD set `accountable` to `0`.
  * MAY set `accountable` to `7` to mimic observed forwarded traffic.

Receiver:
* if `accountable`=7 in the incoming `update_add_htlc`:
    * SHOULD set `accountable` to `7` on its outgoing `update_add_htlc`
* otherwise:
  * if running an experimental reputation algorithm:
    * SHOULD set `accountable` at its discretion.
  * otherwise:
    * SHOULD set `accountable` to `0`.
* MUST NOT use the experimental `accountable` field in resource allocation
  decisions.

## Deployment and Deprecation

Forwarding nodes can upgrade and begin to set `accountable` signals immediately,
as there is no privacy risk associated with propagating zero values.

1. Nodes on the network upgrade to support sending and forwarding zero value 
  `accountable` signals.
2. Nodes running experimental reputation algorithm may set non-zero accountable
signals.
3. Signals can be observed in the network to gather data to inform design of
reputation algorithms.

We only expect nodes running experimental reputation algorithms to set a
non-zero accountable signal in times of congestion; it will be normal for both
sending and forwarding nodes to set zero value signals. There is no privacy
concern for senders setting a zero accountable signal, as this is normal
behavior for both sending and forwarding nodes.

To deprecate the signal once experimentation is complete:

1. Nodes running experimental reputation algorithms stop setting non-zero
values.
2. Remove the `htlc_accountability` feature bit and stop relaying and setting
the TLV.

## Motivation

The emergent properties of network-wide changes to Lightning are difficult to 
fully grasp without gathering real world data. This bLIP outlines a lightweight
and reversible mechanism to assess various reputation algorithms in a read-only
setting so that we can direct further specification in an informed manner.

## Rationale

Positive accountability signals are copied from the incoming `update_add_htlc`
to allow signals to propagate through the network. Nodes wishing to participate
in active experimentation may set this signal according to their local
reputation algorithm, and this signal will be passively propagated by the
upgraded portion of the route. This experimental signal is used to observe
the behavior of reputation algorithms under real-world conditions, but is not
used to allocate resources so that the experiment does not impact payment
traffic.

HTLCs that are not accountable include a TLV with a zero value byte so that
they can be distinguished from those with no accountability signal, which can
be filtered out of experimental data as null values.

**Note: Previously we allowed a range for the `accountable` signal as it was
used to signal endorsement of an HTLC. This endorsement could be interpreted
as the level of trust in the upstream node and the HTLC resolving in time.
Hence, we allowed a range to allow experimenting with different values. This
signal has been repurposed (since it is an experimental read-only field) to
now indicate accountability, which is a binary decision letting the downstream
node know if it will be held accountable for the fast resolution of the HTLC.**

This experiment is opened as a bLIP because it is not intended to be a 
permanent part of the lightning specification. If a BOLT with accountability
signaling is merged to the BOLTs, the two signals can be handled independently 
and the experimental signal described in this bLIP can be removed after the 
end of the experimental period.

## Reference Implementations

* [LDK](https://github.com/lightningdevkit/rust-lightning/pull/4232)
